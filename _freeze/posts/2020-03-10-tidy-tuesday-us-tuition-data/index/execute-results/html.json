{
  "hash": "8291262954dfb801ebfd5271a021e2d8",
  "result": {
    "markdown": "---\ntitle: 'Tidy Tuesday: US Tuition Data'\nauthor: Jonny Law\ndate: \"2020-03-10\"\noutput: distill::distill_article\nslug: \"tidy-tuesday-us-tuition-data\"\ncategories: \n  - [tidy-tuesday, R]\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(jonnylaw)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'dplyr' was built under R version 4.1.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidyr' was built under R version 4.1.2\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(gghighlight)\nlibrary(tidybayes)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidybayes' was built under R version 4.1.2\n```\n:::\n\n```{.r .cell-code}\ntheme_set(theme_minimal())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(2020, week = 11)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Compiling #TidyTuesday Information for 2020-03-10 ----\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- There are 5 files available ---\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Starting Download ---\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tDownloading file 1 of 5: `diversity_school.csv`\n\tDownloading file 2 of 5: `historical_tuition.csv`\n\tDownloading file 3 of 5: `salary_potential.csv`\n\tDownloading file 4 of 5: `tuition_cost.csv`\n\tDownloading file 5 of 5: `tuition_income.csv`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Download complete ---\n```\n:::\n:::\n\n\nThis weeks data consists of tuition costs, salary potential and diversity information of US colleges. This includes 2 year colleges which offer associate degrees, certificates and diplomas and 4 year colleges which offer bachelors and masters degrees. These are further split by private institutions, public and for profit. Additionally, Universities in the US charge different tuition fees for in-state or out-of-state students. Also, the ticket price is not always reflective of the students costs. The fees can be wholly or partially subsidised by scholarships and financial aid.\n\nThe first question which I wanted to answer is which universities have the highest tuition cost and what type of institution are they.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuition_cost <- tuesdata$tuition_cost\n\ntuition_cost %>% \n  top_n(30, wt = in_state_tuition) %>%\n  mutate(name = forcats::fct_reorder(name, in_state_tuition)) %>%\n  ggplot(aes(x = name, y = in_state_tuition, fill = type)) +\n  geom_col() +\n  coord_flip() +\n  scale_y_continuous(labels = scales::dollar_format()) +\n  labs(title = \"Top 30 most expensive colleges\") +\n  ylab(\"College\") +\n  xlab(\"In State Tuition\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n[tidybayes](https://github.com/mjskay/tidybayes) can be used to plot the distribution of in state costs and out of state costs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuition_cost %>% \n  group_by(type) %>% \n  pivot_longer(c(\"out_of_state_total\", \"in_state_total\"), names_to = \"tuition_type\", values_to = \"tuition\") %>% \n  ggplot(aes(x = tuition, y = tuition_type)) +\n  stat_halfeye() +\n  scale_x_continuous(labels = scales::dollar_format()) +\n  labs(title = \"\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Historical Tuition Data\n\nAnother dataset contains the historical tuition values in adjusted US dollars. We can see that private and public tuitions have doubled for four year courses since 1985. It's quite a lot more expensive to attend college in the US now than it was 35 years ago!\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata$historical_tuition %>% \n  mutate(year = substr(year, 1, 4) %>% as.numeric()) %>% \n  ggplot(aes(x = year, y = tuition_cost, colour = tuition_type)) +\n  geom_line() +\n  facet_wrap(~type, ncol = 3) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_y_continuous(labels = scales::dollar_format()) +\n  labs(title = \"Tuition cost in 2016/17 dollars\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Most cost effective Universities\n\nTo quantify the most cost effective university to attend, divide the mid career pay by the total tuition paid for a 4-year degree (bachelors or masters degree).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsalary <- tuesdata$salary_potential\n\nsalary %>% \n  left_join(tuesdata$tuition_cost %>% filter(degree_length == \"4 Year\")) %>% \n  pivot_longer(c(\"out_of_state_total\", \"in_state_total\"), names_to = \"tuition_type\", values_to = \"tuition\") %>% \n  mutate(ratio = mid_career_pay / tuition,\n         name_cost = paste(name, scales::dollar(tuition))) %>%\n  ggplot(aes(x = ratio, y = tuition)) +\n  geom_point() +\n  facet_wrap(~tuition_type, ncol = 1) +\n  scale_y_continuous(labels = scales::dollar_format()) +\n  xlab(\"Mid Career Earnings / Tuition Fee\") +\n  ylab(\"Tuition\") +\n  labs(title = \"Yearly Tuition Costs and Mid Career Earnings\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = \"name\"\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 428 rows containing missing values (geom_point).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n# Net cost by income bracket\n\nUsing tidybayes again to view the distribution of the net-costs by income bracket. The data has a peak at zero for those receiveing full scholarships. Interesting they seem most prevelant for those with an income over Â£110,000!\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata$tuition_income %>% \n  ggplot(aes(y = income_lvl, x = net_cost)) +\n  stat_halfeye() +\n  scale_x_continuous(labels = scales::dollar_format()) +\n  labs(title = \"Distribution of tuition cost paid by income level\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n# Diversity of top 20 Forbes Colleges\n\nTo create a chart of diversity such as that on the [priceonomics](https://priceonomics.com/ranking-the-most-and-least-diverse-colleges-in/) blog I took the top 20 colleges according to Forbes [from wikipedia](https://en.wikipedia.org/wiki/Rankings_of_universities_in_the_United_States#Forbes_college_rankings). I copied the table to an R tribble using [data pasta](https://cran.r-project.org/web/packages/datapasta/vignettes/how-to-datapasta.html).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_unis <- tibble::tribble(\n                              ~name, ~ranking,\n                     \"Harvard University\", 1,\n                    \"Stanford University\", 2,\n                        \"Yale University\", 3,\n  \"Massachusetts Institute of Technology\", 4,\n                   \"Princeton University\", 5,\n             \"University of Pennsylvania\", 6,\n                       \"Brown University\", 7,\n     \"California Institute of Technology\", 8,\n                        \"Duke University\", 9,\n                      \"Dartmouth College\", 10,\n                     \"Cornell University\", 11,\n                         \"Pomona College\", 12,\n     \"University of California, Berkeley\", 13,\n                    \"Columbia University\", 14,\n                  \"Georgetown University\", 15,\n                  \"University of Chicago\", 16,\n                \"Northwestern University\", 17,\n               \"University of Notre Dame\", 18,\n       \"Rensselaer Polytechnic Institute\", 19,\n                 \"University of Michigan\", 20\n  )\n```\n:::\n\n\nThe [Herfindahl-Hirschman index](https://en.wikipedia.org/wiki/Herfindahl%E2%80%93Hirschman_Index) is used as a measure of diversity at each college. The general formula is:\n\n\n$$HHI = \\sum_{i=1}^Na^2_i$$\n\nWhere $a_i$ represents the proportion of the $i^{th}$ race and $N = 5$ consisting of the number of races under consideration: White, Black, Hispanic, Asian and other. So for a completely homogeneous population $a_1 = 1$ and $a_{2:5} = 0$, hence $HHI = 1^2 + 0^2 + 0^2 + 0^2 + 0^2 = 1$. The following plot shows the Forbes top 20 univesities ordered by diversity according to the HHI.\n\n::: {.cell}\n\n```{.r .cell-code}\ndiversity <- tuesdata$diversity_school\n\nracial_diversity <- diversity %>% \n  filter(!is.na(name)) %>% \n  filter(category %in% c(\"White\", \"Black\", \"Hispanic\", \"Asian\")) %>% \n  pivot_wider(names_from = category, values_from = enrollment) %>% \n  mutate(other = total_enrollment - White - Black - Hispanic - Asian) %>% \n  pivot_longer(4:8, names_to = \"category\", values_to = \"enrollment\") %>% \n  group_by(name) %>% \n  mutate(hhi = sum((enrollment / total_enrollment) ** 2))\n\nracial_diversity %>% \n  inner_join(top_unis) %>% \n  ungroup() %>% \n  mutate(\n    name_hhi = paste(ranking, name, round(hhi, 2)),\n    name_hhi = forcats::fct_reorder(name_hhi, desc(hhi))) %>% \n  filter(ranking <= 20) %>% \n  ggplot() +\n  geom_col(aes(y = name_hhi, x = enrollment, fill = category), position = \"fill\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = \"name\"\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\nThe next plot considers diversity as measured by HHI against potential earnings at mid career. This is the plot I chose to tweet for tidy tuesday.\n\n::: {.cell}\n\n```{.r .cell-code}\nracial_diversity %>%\n  inner_join(salary, by = c(\"name\")) %>%\n  distinct(name, hhi, mid_career_pay) %>%\n  ggplot(aes(x = hhi, y = mid_career_pay, colour = name)) +\n  geom_point() +\n  gghighlight(mid_career_pay > 1.55e5 |\n                hhi > 0.9, use_direct_label = TRUE) +\n  scale_y_continuous(labels = scales::dollar_format()) +\n  labs(\n    title = \"Expected Pay and Racial Diversity at US Universities\",\n    subtitle = \"Racial Diversity is calculated using HHI\\nwhich ranges from 0.2 (most diverse) to 1 (least diverse).\") +\n    ylab(\"Mid Career Pay\") +\n    xlab(\"Herfindahl-Hirschman index\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `across()` in `filter()` is deprecated, use `if_any()` or\n`if_all()`.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nlabel_key: name\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggsave(\"diversity.png\")\n```\n:::\n\n# Tweet\n\nNow use the [rtweet](https://rtweet.info/) library to post the plots directly to Twitter without leaving R. You must connect to the Twitter API using OAuth as described in [this vignette](https://rtweet.info/articles/auth.html), I set the Twitter application keys in my `.Renviron` file which is never committed to public version control (this can be easily edited using `usethis::edit_r_environ()`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rtweet)\n\ntoken <- create_token(\n  app = \"rstats\",\n  consumer_key = Sys.getenv(\"TWITTER_API_KEY\"), \n  consumer_secret = Sys.getenv(\"TWITTER_API_SECRET_KEY\"),\n  access_token = Sys.getenv(\"TWITTER_ACCESS_TOKEN\"),\n  access_secret = Sys.getenv(\"TWITTER_ACCESS_TOKEN_SECRET\"))\n```\n:::\n\nThe function `post_tweet` can be used to post a new tweet.\n\n::: {.cell}\n\n```{.r .cell-code}\npost_tweet(\n  status = \"This week's #TidyTuesday features diversity, tuition costs and expected salaries at US universities. It appears more diverse colleges tend to have higher earning graduates. #rstats\",\n  media = c(\"diversity.png\", \"carbon.png\"),\n  token = token\n)\n```\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}